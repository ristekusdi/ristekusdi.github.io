import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.cc795e4d.js";const p="/assets/sso-web-demo-basic.30372d80.png",o="/assets/sso-web-demo-advance-error.f9633247.png",e="/assets/sso-web-demo-advance-1.65fe4945.png",t="/assets/sso-web-demo-advance-2.13f4a428.png",m=JSON.parse('{"title":"SSO Laravel","description":"","frontmatter":{},"headers":[],"relativePath":"sso-laravel.md","filePath":"sso-laravel.md"}'),c={name:"sso-laravel.md"},r=l(`<h1 id="sso-laravel" tabindex="-1">SSO Laravel <a class="header-anchor" href="#sso-laravel" aria-label="Permalink to &quot;SSO Laravel&quot;">​</a></h1><p>Petunjuk penggunaan pustaka SSO Laravel Universitas Udayana.</p><h2 id="prasyarat" tabindex="-1">Prasyarat <a class="header-anchor" href="#prasyarat" aria-label="Permalink to &quot;Prasyarat&quot;">​</a></h2><ul><li>PHP versi minimal 7.4.</li><li>Laravel versi 6 sampai 10.</li></ul><blockquote><p>Catatan saat pengujian tutorial dilakukan pada Laravel versi 8. Bila Anda mengalami kendala silakan buat <a href="https://github.com/ristekusdi/sso-laravel/issues" target="_blank" rel="noreferrer">isu di ristekusdi/sso-laravel</a>.</p></blockquote><h2 id="tutorial-web-guard-tingkat-dasar" tabindex="-1">Tutorial Web Guard - Tingkat Dasar <a class="header-anchor" href="#tutorial-web-guard-tingkat-dasar" aria-label="Permalink to &quot;Tutorial Web Guard - Tingkat Dasar&quot;">​</a></h2><p>Tutorial ini akan menjelaskan cara memproteksi halaman-halaman dengan otentikasi SSO IMISSU.</p><ol><li>Instal <code>ristekusdi/sso-laravel</code> dengan perintah.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">composer</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">require</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ristekusdi/sso-laravel</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">composer</span><span style="color:#24292E;"> </span><span style="color:#032F62;">require</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ristekusdi/sso-laravel</span></span></code></pre></div><p>Setelah diinstal, silakan ambil nilai environment SSO di website IMISSU2 dev atau IMISSU2 dan taruh di file <code>.env</code>.</p><ol start="2"><li>Jalankan perintah di bawah ini.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">php</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">artisan</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vendor:publish</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--tag=sso-laravel-web-demo-basic</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">php</span><span style="color:#24292E;"> </span><span style="color:#032F62;">artisan</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vendor:publish</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--tag=sso-laravel-web-demo-basic</span></span></code></pre></div><p>Perintah di atas untuk mengimpor file-file antara lain:</p><ul><li>app/Http/Controllers/SSO/Web/AuthController.php</li><li>app/Http/Controllers/SSO/Web/DemoController.php</li><li>app/Models/SSO/Web/User.php</li><li>config/sso.php</li><li>resources/views/sso-web/basic.blade.php</li><li>resources/views/sso-web/demo.blade.php</li><li>routes/sso-web-demo.php</li></ul><ol start="3"><li>Tambahkan guard dan provider <code>imissu-web</code> di <code>config/auth.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// Tambahkan ini di dalam array dengan key &#39;guards&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;driver&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;provider&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Tambahkan ini di dalam array dengan key &#39;providers&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;driver&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;model&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">App\\Models\\SSO\\Web\\User</span><span style="color:#F97583;">::class</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">],</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// Tambahkan ini di dalam array dengan key &#39;guards&#39;</span></span>
<span class="line"><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;driver&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;provider&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Tambahkan ini di dalam array dengan key &#39;providers&#39;</span></span>
<span class="line"><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;driver&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;model&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">App\\Models\\SSO\\Web\\User</span><span style="color:#D73A49;">::class</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">],</span></span></code></pre></div><ol start="4"><li>Impor route <code>sso-web</code> dengan perintah berikut.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Laravel</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7</span></span>
<span class="line"><span style="color:#B392F0;">php</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">artisan</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vendor:publish</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--tag=sso-laravel-web-route-v1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Laravel</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">9</span></span>
<span class="line"><span style="color:#B392F0;">php</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">artisan</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vendor:publish</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--tag=sso-laravel-web-route-v2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Laravel</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7</span></span>
<span class="line"><span style="color:#6F42C1;">php</span><span style="color:#24292E;"> </span><span style="color:#032F62;">artisan</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vendor:publish</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--tag=sso-laravel-web-route-v1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Laravel</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">9</span></span>
<span class="line"><span style="color:#6F42C1;">php</span><span style="color:#24292E;"> </span><span style="color:#032F62;">artisan</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vendor:publish</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--tag=sso-laravel-web-route-v2</span></span></code></pre></div><p>Perintah ini akan menghasilkan file <code>sso-web.php</code> di folder <code>routes</code>.</p><ol start="5"><li>Tambahkan route <code>sso-web.php</code> ke dalam file <code>routes/web.php</code>. Ini berfungsi untuk menambahkan route SSO (login, callback, logout).</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">require</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__DIR__</span><span style="color:#F97583;">.</span><span style="color:#9ECBFF;">&#39;/sso-web.php&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">require</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__DIR__</span><span style="color:#D73A49;">.</span><span style="color:#032F62;">&#39;/sso-web.php&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><ol start="6"><li>Ubah nilai <code>redirect_url</code> menjadi <code>&#39;/sso-web-basic&#39;</code> di <code>config/sso.php</code>.</li></ol><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#FDAEB7;">- &#39;redirect_url&#39; =&gt; &#39;/&#39;,</span></span>
<span class="line"><span style="color:#85E89D;">+ &#39;redirect_url&#39; =&gt; &#39;/sso-web-demo&#39;,</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#B31D28;">- &#39;redirect_url&#39; =&gt; &#39;/&#39;,</span></span>
<span class="line"><span style="color:#22863A;">+ &#39;redirect_url&#39; =&gt; &#39;/sso-web-demo&#39;,</span></span></code></pre></div><p>Hal ini bertujuan ketika login dengan SSO maka langsung diarahkan ke halaman <code>/sso-web-demo</code>.</p><ol start="7"><li>Tambahkan route <code>sso-web-demo.php</code> ke dalam file <code>routes/web.php</code> untuk melihat demo SSO web.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">require</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__DIR__</span><span style="color:#F97583;">.</span><span style="color:#9ECBFF;">&#39;/sso-web-demo.php&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">require</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__DIR__</span><span style="color:#D73A49;">.</span><span style="color:#032F62;">&#39;/sso-web-demo.php&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><ol start="8"><li><p>Buka halaman <code>/sso-web-demo</code> dengan URL <code>http://localhost:&lt;port&gt;/sso-web-demo</code> atau <code>http://yourapp.test/sso-web-demo</code> dengan bantuan <a href="https://laragon.org/docs/pretty-urls.html" target="_blank" rel="noreferrer">Laragon</a>.</p></li><li><p>Klik tautan &quot;Basic&quot; dan tampilannya seperti gambar di bawah.</p></li></ol><p><img src="`+p+'" alt="Image of SSO web basic"></p><div class="tip custom-block"><p class="custom-block-title">RANGKUMAN</p><p>Pada tutorial Web Guard tingkat dasar ini kita telah belajar cara:</p><ul><li>Instalasi package ristekusdi/sso-laravel.</li><li>Mendaftarkan guard dan provider imissu-web di config/auth.php.</li><li>Mendaftarkan route SSO web untuk login, callback, dan logout.</li><li>Mengubah nilai redirect_url di config/sso.php.</li><li>Melihat halaman SSO web demo basic sebagai contoh implementasi Web Guard tingkat dasar.</li></ul></div><h2 id="tutorial-web-guard-tingkat-lanjut" tabindex="-1">Tutorial Web Guard - Tingkat Lanjut <a class="header-anchor" href="#tutorial-web-guard-tingkat-lanjut" aria-label="Permalink to &quot;Tutorial Web Guard - Tingkat Lanjut&quot;">​</a></h2><div class="danger custom-block"><p class="custom-block-title">PERINGATAN</p><p>Anda diwajibkan mengikuti Tutorial Web Guard Tingkat Dasar terlebih dahulu!</p></div><p>Kita akan belajar menyisipkan atribut tambahan seperti <code>role_active</code> dan <code>role_active_permission</code> di objek pengguna IMISSU dan mengubah nilai dari <code>role_active</code> dengan <code>session</code>.</p><ol><li>Jalankan perintah di bawah ini.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">php</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">artisan</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vendor:publish</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--tag=sso-laravel-web-demo-advance</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">php</span><span style="color:#24292E;"> </span><span style="color:#032F62;">artisan</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vendor:publish</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--tag=sso-laravel-web-demo-advance</span></span></code></pre></div><p>Perintah tersebut akan mengimpor file resources/views/sso-web/advance.blade.php untuk tahap berikutnya.</p><ol start="2"><li>Akses halaman demo dengan <code>http://localhost:&lt;port&gt;/sso-web-demo</code> atau <code>http://yourapp.test/sso-web-demo</code> di aplikasi. Klik tautan &quot;Advance&quot; dan Anda akan mendapatkan tampilan halaman berikut.</li></ol><p><img src="'+o+`" alt="Image of SSO web demo advance error"></p><p>Pada gambar di atas, kita belum mendapatkan nilai dari peran aktif dan daftar permission yang melekat pada peran aktif (lihat pada tanda <code>???</code> di gambar). Tugas kita adalah memperbaiki bug tersebut.</p><ol start="3"><li>Kita akan menerapkan <a href="https://laravel.com/docs/8.x/eloquent-mutators#accessors-and-mutators" target="_blank" rel="noreferrer">konsep Accessor dan Mutators Laravel</a> untuk menangani kondisi ini. Buka file <code>app/Models/SSO/Web/User.php</code> dan ikuti isian seperti kode di bawah.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;?</span><span style="color:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">App\\Models\\SSO\\Web</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">RistekUSDI\\SSO\\Laravel\\Models\\Web\\User</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Model</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Model</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> $appends </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;role_active_permissions&#39;</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setRoleActiveAttribute</span><span style="color:#E1E4E8;">($value)</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">attributes[</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">, $value);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">attributes[</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> $value;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getRoleActiveAttribute</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">attributes[</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">attributes[</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">getAttribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;client_roles&#39;</span><span style="color:#E1E4E8;">)[</span><span style="color:#9ECBFF;">&#39;0&#39;</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getRoleActivePermissionsAttribute</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        $role_active </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">getAttribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;client_roles&#39;</span><span style="color:#E1E4E8;">)[</span><span style="color:#9ECBFF;">&#39;0&#39;</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            $role_active </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        $permissions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;Admin&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;disable-user&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;manage-roles&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;impersonate&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            ],</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;Developer&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;manage-settings&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;manage-users&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;manage-roles&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;impersonate&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            ],</span></span>
<span class="line"><span style="color:#E1E4E8;">        ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        $selected_permissions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">foreach</span><span style="color:#E1E4E8;"> ($permissions </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> $key </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> $value) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> ($key </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> $role_active) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                $selected_permissions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> $permissions[$key];</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">attributes[</span><span style="color:#9ECBFF;">&#39;role_active_permissions&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> $selected_permissions;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;?</span><span style="color:#005CC5;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">namespace</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">App\\Models\\SSO\\Web</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">use</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">RistekUSDI\\SSO\\Laravel\\Models\\Web\\User</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Model</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Model</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> $appends </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;role_active_permissions&#39;</span><span style="color:#24292E;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setRoleActiveAttribute</span><span style="color:#24292E;">($value)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">has</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">attributes[</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">, $value);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">attributes[</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> $value;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getRoleActiveAttribute</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">has</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">attributes[</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">attributes[</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">getAttribute</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;client_roles&#39;</span><span style="color:#24292E;">)[</span><span style="color:#032F62;">&#39;0&#39;</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getRoleActivePermissionsAttribute</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        $role_active </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">getAttribute</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;client_roles&#39;</span><span style="color:#24292E;">)[</span><span style="color:#032F62;">&#39;0&#39;</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">has</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">            $role_active </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        $permissions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;Admin&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;disable-user&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;manage-roles&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;impersonate&#39;</span></span>
<span class="line"><span style="color:#24292E;">            ],</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;Developer&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;manage-settings&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;manage-users&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;manage-roles&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;impersonate&#39;</span></span>
<span class="line"><span style="color:#24292E;">            ],</span></span>
<span class="line"><span style="color:#24292E;">        ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        $selected_permissions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">foreach</span><span style="color:#24292E;"> ($permissions </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> $key </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> $value) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> ($key </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> $role_active) {</span></span>
<span class="line"><span style="color:#24292E;">                $selected_permissions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> $permissions[$key];</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">attributes[</span><span style="color:#032F62;">&#39;role_active_permissions&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> $selected_permissions;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><ol start="4"><li>Refresh halaman &quot;Advance&quot; maka nilai <code>role_active</code> dan <code>role_active_permissions</code> sudah berubah seperti gambar di bawah.</li></ol><p><img src="`+e+`" alt="Image of SSO web demo advance fix part 1"></p><ol start="5"><li>Kita akan mengubah session <code>role_active</code>. Tambahkan kode berikut di dalam group middleware <code>imissu-web</code> di file <code>routes/sso-web-demo.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">Route</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">middleware</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">])</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">group</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> () {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Laravel 6 - 7</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Route</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/sso-web-demo/change-role-active&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;App\\Http\\Controllers\\SSO\\Web\\DemoController@changeRoleActive&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Laravel 8 - 9</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Route</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/sso-web-demo/change-role-active&#39;</span><span style="color:#E1E4E8;">, [</span><span style="color:#79B8FF;">App\\Http\\Controllers\\SSO\\Web\\DemoController</span><span style="color:#F97583;">::class</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;changeRoleActive&#39;</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">Route</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">middleware</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">])</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">group</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> () {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Laravel 6 - 7</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Route</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/sso-web-demo/change-role-active&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;App\\Http\\Controllers\\SSO\\Web\\DemoController@changeRoleActive&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Laravel 8 - 9</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Route</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/sso-web-demo/change-role-active&#39;</span><span style="color:#24292E;">, [</span><span style="color:#005CC5;">App\\Http\\Controllers\\SSO\\Web\\DemoController</span><span style="color:#D73A49;">::class</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;changeRoleActive&#39;</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><ol start="6"><li>Tambahkan kode berikut di <code>resources/views/sso-web/advance.blade.php</code>.</li></ol><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">input</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;hidden&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;url_change_role_active&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;{{ url(&#39;/sso-web-demo/change-role-active&#39;) }}&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;roles-combo&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">onchange</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> e.target.value;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">url</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">querySelector</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;input[name=&quot;url_change_role_active&quot;]&#39;</span><span style="color:#E1E4E8;">).value;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">current_url</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">querySelector</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;input[name=&quot;current_url&quot;]&#39;</span><span style="color:#E1E4E8;">).value;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">token</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">querySelector</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">getAttribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;content&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (value </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;0&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">fetch</span><span style="color:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="color:#E1E4E8;">                headers: {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#9ECBFF;">&#39;Content-Type&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;application/x-www-form-urlencoded&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#9ECBFF;">&#39;X-CSRF-TOKEN&#39;</span><span style="color:#E1E4E8;">: token</span></span>
<span class="line"><span style="color:#E1E4E8;">                },</span></span>
<span class="line"><span style="color:#E1E4E8;">                method: </span><span style="color:#9ECBFF;">&#39;POST&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                credentials: </span><span style="color:#9ECBFF;">&#39;same-origin&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                body: </span><span style="color:#9ECBFF;">\`role_active=\${</span><span style="color:#E1E4E8;">value</span><span style="color:#9ECBFF;">}\`</span></span>
<span class="line"><span style="color:#E1E4E8;">            })</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">response</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> response.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (data.code </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    window.location.href </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> current_url;</span></span>
<span class="line"><span style="color:#E1E4E8;">                } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">alert</span><span style="color:#E1E4E8;">(data.message);</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            });</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">input</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;hidden&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;url_change_role_active&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;{{ url(&#39;/sso-web-demo/change-role-active&#39;) }}&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    document.</span><span style="color:#6F42C1;">getElementById</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;roles-combo&#39;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">onchange</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> e.target.value;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">url</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">querySelector</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;input[name=&quot;url_change_role_active&quot;]&#39;</span><span style="color:#24292E;">).value;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">current_url</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">querySelector</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;input[name=&quot;current_url&quot;]&#39;</span><span style="color:#24292E;">).value;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">token</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">querySelector</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">getAttribute</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;content&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (value </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;0&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">fetch</span><span style="color:#24292E;">(url, {</span></span>
<span class="line"><span style="color:#24292E;">                headers: {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#032F62;">&#39;Content-Type&#39;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;application/x-www-form-urlencoded&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#032F62;">&#39;X-CSRF-TOKEN&#39;</span><span style="color:#24292E;">: token</span></span>
<span class="line"><span style="color:#24292E;">                },</span></span>
<span class="line"><span style="color:#24292E;">                method: </span><span style="color:#032F62;">&#39;POST&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                credentials: </span><span style="color:#032F62;">&#39;same-origin&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                body: </span><span style="color:#032F62;">\`role_active=\${</span><span style="color:#24292E;">value</span><span style="color:#032F62;">}\`</span></span>
<span class="line"><span style="color:#24292E;">            })</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">(</span><span style="color:#E36209;">response</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> response.</span><span style="color:#6F42C1;">json</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">(</span><span style="color:#E36209;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (data.code </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">200</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    window.location.href </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> current_url;</span></span>
<span class="line"><span style="color:#24292E;">                } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">alert</span><span style="color:#24292E;">(data.message);</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            });</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><ol start="7"><li>Tambahkan kode berikut di <code>app/Http/Controllers/Web/DemoController.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// ..</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">changeRoleActive</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Request</span><span style="color:#E1E4E8;"> $request)</span></span>
<span class="line"><span style="color:#E1E4E8;">{   </span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">changeRoleActive</span><span style="color:#E1E4E8;">($request</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">role_active);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">role_active </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> $request</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">role_active) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">response</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">([</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;message&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Berhasil mengubah peran aktif&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;code&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">200</span></span>
<span class="line"><span style="color:#E1E4E8;">        ], </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">response</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">([</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;message&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Gagal mengubah peran aktif&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;code&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">403</span></span>
<span class="line"><span style="color:#E1E4E8;">        ], </span><span style="color:#79B8FF;">403</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#6A737D;">// ..</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">changeRoleActive</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Request</span><span style="color:#24292E;"> $request)</span></span>
<span class="line"><span style="color:#24292E;">{   </span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">changeRoleActive</span><span style="color:#24292E;">($request</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">role_active);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">role_active </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> $request</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">role_active) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">response</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">json</span><span style="color:#24292E;">([</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;message&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Berhasil mengubah peran aktif&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;code&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">200</span></span>
<span class="line"><span style="color:#24292E;">        ], </span><span style="color:#005CC5;">200</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">response</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">json</span><span style="color:#24292E;">([</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;message&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Gagal mengubah peran aktif&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;code&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">403</span></span>
<span class="line"><span style="color:#24292E;">        ], </span><span style="color:#005CC5;">403</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><ol start="8"><li>Tambahkan kode berikut di <code>app/Model/SSO/Web/User.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line highlighted"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">changeRoleActive</span><span style="color:#E1E4E8;">($role_active)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">forget</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">, $role_active);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line highlighted"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">changeRoleActive</span><span style="color:#24292E;">($role_active)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">forget</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">, $role_active);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><ol start="9"><li>Di halaman &quot;Advance&quot; ubah peran Admin menjadi Developer dan hasilnya seperti gambar di bawah.</li></ol><p><img src="`+t+`" alt="Image of SSO web demo advance fix part 2"></p><p>Kita telah menambahkan atribut tambahan dari session aplikasi. Bagaimana cara menghapusnya saat pengguna keluar aplikasi? Jika Anda sudah mengikuti langkah 5 sampai 8 mungkin Anda sudah menemukan caranya. Jika belum, kita lanjutkan tutorial ini.</p><ol start="11"><li>Sisipkan baris perintah berikut di method <code>logout()</code> di baris pertama di <code>app/Http/Controllers/SSO/Web/AuthController.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">logout</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">forgetSession</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    $url </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">IMISSUWeb</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">getLogoutUrl</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">redirect</span><span style="color:#E1E4E8;">($url);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">logout</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">forgetSession</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    $url </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">IMISSUWeb</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">getLogoutUrl</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">redirect</span><span style="color:#24292E;">($url);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>Di baris ke-3 yang disoroti tersebut kita menyisipkan perintah <code>forgetSession()</code>.</p><ol start="12"><li>Tambahkan kode berikut di <code>app/Models/SSO/Web/User.php</code></li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line highlighted"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">forgetSession</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">forget</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;role_active_permissions&#39;</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line highlighted"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">forgetSession</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">forget</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;role_active_permissions&#39;</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">PERINGATAN</p><p>Jika kita menggunakan perintah <code>session()-&gt;flush()</code> maka akan menghapus session <code>access_token</code> dan <code>refresh_token</code> SSO. Sehingga, kita gunakan <code>session()-&gt;forget()</code> sebagai penggantinya.</p></div><p>Klik tautan &quot;Log out&quot; dan session aplikasi terhapus saat pengguna keluar dari aplikasi.</p><p>Tutorial selesai. 🎉</p><div class="tip custom-block"><p class="custom-block-title">RANGKUMAN</p><p>Pada tutorial Web Guard tingkat lanjut ini kita telah belajar cara:</p><ul><li>Menerapkan Accessor dan Mutator untuk atribut tambahan seperti <code>role_active</code> dan <code>role_active_permissions</code> di User model.</li><li>Mengubah <code>role_active</code> dari langkah 5 sampai 8.</li></ul></div><h2 id="tutorial-web-guard-refactoring" tabindex="-1">Tutorial Web Guard - Refactoring <a class="header-anchor" href="#tutorial-web-guard-refactoring" aria-label="Permalink to &quot;Tutorial Web Guard - Refactoring&quot;">​</a></h2><p>Refactoring adalah proses mengubah struktur kode program tanpa mengubah atau menambah fungsi program yang sudah ada. Manfaat dari proses refactoring antara lain memudahkan kode program dibaca dan dipahami oleh programmer lain.</p><p>Pada tutorial Web Guard tingkat lanjut kita sudah menyisipkan atribut tambahan seperti <code>role_active</code> dan <code>role_active_permissions</code> dari session aplikasi, mengubah session <code>role_active</code>, dan menghapus session aplikasi. Setiap sistem pasti memiliki kebutuhan atribut-atribut tambahan yang beragam dan pasti akan membuat baris kode dalam suatu file akan panjang sehingga sulit dibaca oleh programmer.</p><p>Disinilah peran penting dari Refactoring! Kita akan memulai proses refactoring.</p><ol><li>Jalankan perintah di bawah ini.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">php</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">artisan</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vendor:publish</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--tag=sso-laravel-web-session</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">php</span><span style="color:#24292E;"> </span><span style="color:#032F62;">artisan</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vendor:publish</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--tag=sso-laravel-web-session</span></span></code></pre></div><p>Perintah di atas untuk mengimpor file-file antara lain:</p><ul><li>app/Http/Controllers/SSO/Web/SessionController.php</li><li>app/Facades/WebSession.php</li><li>app/Providers/WebSessionProvider.php</li><li>app/Services/WebSession.php</li><li>routes/web-session.php</li></ul><ol start="2"><li>Daftarkan route <code>web-session.php</code> ke dalam file <code>routes/web.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">require</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__DIR__</span><span style="color:#F97583;">.</span><span style="color:#9ECBFF;">&#39;/web-session.php&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">require</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__DIR__</span><span style="color:#D73A49;">.</span><span style="color:#032F62;">&#39;/web-session.php&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><ol start="3"><li>Hapus baris kode di file <code>routes/sso-web-demo.php</code> dan tambahkan baris kode di file <code>routes/web-session.php</code>.</li></ol><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">// routes/sso-web-demo.php</span></span>
<span class="line"><span style="color:#E1E4E8;">// Laravel 6 - 7</span></span>
<span class="line"><span style="color:#FDAEB7;">- Route::post(&#39;/sso-web-demo/change-role-active&#39;, &#39;App\\Http\\Controllers\\SSO\\Web\\DemoController@changeRoleActive&#39;]);</span></span>
<span class="line"><span style="color:#E1E4E8;">// Laravel 8 - 9</span></span>
<span class="line"><span style="color:#FDAEB7;">- Route::post(&#39;/sso-web-demo/change-role-active&#39;, [App\\Http\\Controllers\\SSO\\Web\\DemoController::class, &#39;changeRoleActive&#39;]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">// routes/web-session.php</span></span>
<span class="line"><span style="color:#E1E4E8;">// Laravel 6 - 7</span></span>
<span class="line"><span style="color:#85E89D;">+ Route::post(&#39;/web-session/change-role-active&#39;, &#39;App\\Http\\Controllers\\SSO\\Web\\SessionController@changeRoleActive&#39;);</span></span>
<span class="line"><span style="color:#E1E4E8;">// Laravel 8 - 9</span></span>
<span class="line"><span style="color:#85E89D;">+ Route::post(&#39;/web-session/change-role-active&#39;, [App\\Http\\Controllers\\SSO\\Web\\SessionController::class, &#39;changeRoleActive&#39;]);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">// routes/sso-web-demo.php</span></span>
<span class="line"><span style="color:#24292E;">// Laravel 6 - 7</span></span>
<span class="line"><span style="color:#B31D28;">- Route::post(&#39;/sso-web-demo/change-role-active&#39;, &#39;App\\Http\\Controllers\\SSO\\Web\\DemoController@changeRoleActive&#39;]);</span></span>
<span class="line"><span style="color:#24292E;">// Laravel 8 - 9</span></span>
<span class="line"><span style="color:#B31D28;">- Route::post(&#39;/sso-web-demo/change-role-active&#39;, [App\\Http\\Controllers\\SSO\\Web\\DemoController::class, &#39;changeRoleActive&#39;]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">// routes/web-session.php</span></span>
<span class="line"><span style="color:#24292E;">// Laravel 6 - 7</span></span>
<span class="line"><span style="color:#22863A;">+ Route::post(&#39;/web-session/change-role-active&#39;, &#39;App\\Http\\Controllers\\SSO\\Web\\SessionController@changeRoleActive&#39;);</span></span>
<span class="line"><span style="color:#24292E;">// Laravel 8 - 9</span></span>
<span class="line"><span style="color:#22863A;">+ Route::post(&#39;/web-session/change-role-active&#39;, [App\\Http\\Controllers\\SSO\\Web\\SessionController::class, &#39;changeRoleActive&#39;]);</span></span></code></pre></div><ol start="4"><li>Hapus baris kode di bawah ini pada file <code>app/Http/Controllers/SSO/Web/DemoController.php</code>.</li></ol><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#FDAEB7;">- public function changeRoleActive(Request $request)</span></span>
<span class="line"><span style="color:#FDAEB7;">- {   </span></span>
<span class="line"><span style="color:#FDAEB7;">-    auth(&#39;imissu-web&#39;)-&gt;user()-&gt;changeRoleActive($request-&gt;role_active);</span></span>
<span class="line"><span style="color:#FDAEB7;">-    if (auth(&#39;imissu-web&#39;)-&gt;user()-&gt;role_active === $request-&gt;role_active) {</span></span>
<span class="line"><span style="color:#FDAEB7;">-        return response()-&gt;json([</span></span>
<span class="line"><span style="color:#FDAEB7;">-            &#39;message&#39; =&gt; &#39;Berhasil mengubah peran aktif&#39;,</span></span>
<span class="line"><span style="color:#FDAEB7;">-            &#39;code&#39; =&gt; 200</span></span>
<span class="line"><span style="color:#FDAEB7;">-        ], 200);</span></span>
<span class="line"><span style="color:#FDAEB7;">-    } else {</span></span>
<span class="line"><span style="color:#FDAEB7;">-        return response()-&gt;json([</span></span>
<span class="line"><span style="color:#FDAEB7;">-            &#39;message&#39; =&gt; &#39;Gagal mengubah peran aktif&#39;,</span></span>
<span class="line"><span style="color:#FDAEB7;">-            &#39;code&#39; =&gt; 403</span></span>
<span class="line"><span style="color:#FDAEB7;">-        ], 403);</span></span>
<span class="line"><span style="color:#FDAEB7;">-    }</span></span>
<span class="line"><span style="color:#FDAEB7;">- }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#B31D28;">- public function changeRoleActive(Request $request)</span></span>
<span class="line"><span style="color:#B31D28;">- {   </span></span>
<span class="line"><span style="color:#B31D28;">-    auth(&#39;imissu-web&#39;)-&gt;user()-&gt;changeRoleActive($request-&gt;role_active);</span></span>
<span class="line"><span style="color:#B31D28;">-    if (auth(&#39;imissu-web&#39;)-&gt;user()-&gt;role_active === $request-&gt;role_active) {</span></span>
<span class="line"><span style="color:#B31D28;">-        return response()-&gt;json([</span></span>
<span class="line"><span style="color:#B31D28;">-            &#39;message&#39; =&gt; &#39;Berhasil mengubah peran aktif&#39;,</span></span>
<span class="line"><span style="color:#B31D28;">-            &#39;code&#39; =&gt; 200</span></span>
<span class="line"><span style="color:#B31D28;">-        ], 200);</span></span>
<span class="line"><span style="color:#B31D28;">-    } else {</span></span>
<span class="line"><span style="color:#B31D28;">-        return response()-&gt;json([</span></span>
<span class="line"><span style="color:#B31D28;">-            &#39;message&#39; =&gt; &#39;Gagal mengubah peran aktif&#39;,</span></span>
<span class="line"><span style="color:#B31D28;">-            &#39;code&#39; =&gt; 403</span></span>
<span class="line"><span style="color:#B31D28;">-        ], 403);</span></span>
<span class="line"><span style="color:#B31D28;">-    }</span></span>
<span class="line"><span style="color:#B31D28;">- }</span></span></code></pre></div><ol start="5"><li>Tambahkan baris kode di bawah ini pada file <code>app/Http/Controllers/SSO/Web/SessionController.php</code>.</li></ol><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">+ public function changeRoleActive(Request $request)</span></span>
<span class="line"><span style="color:#85E89D;">+ {   </span></span>
<span class="line"><span style="color:#85E89D;">+    auth(&#39;imissu-web&#39;)-&gt;user()-&gt;changeRoleActive($request-&gt;role_active);</span></span>
<span class="line"><span style="color:#85E89D;">+    if (auth(&#39;imissu-web&#39;)-&gt;user()-&gt;role_active === $request-&gt;role_active) {</span></span>
<span class="line"><span style="color:#85E89D;">+        return response()-&gt;json([</span></span>
<span class="line"><span style="color:#85E89D;">+            &#39;message&#39; =&gt; &#39;Berhasil mengubah peran aktif&#39;,</span></span>
<span class="line"><span style="color:#85E89D;">+            &#39;code&#39; =&gt; 200</span></span>
<span class="line"><span style="color:#85E89D;">+        ], 200);</span></span>
<span class="line"><span style="color:#85E89D;">+    } else {</span></span>
<span class="line"><span style="color:#85E89D;">+        return response()-&gt;json([</span></span>
<span class="line"><span style="color:#85E89D;">+            &#39;message&#39; =&gt; &#39;Gagal mengubah peran aktif&#39;,</span></span>
<span class="line"><span style="color:#85E89D;">+            &#39;code&#39; =&gt; 403</span></span>
<span class="line"><span style="color:#85E89D;">+        ], 403);</span></span>
<span class="line"><span style="color:#85E89D;">+    }</span></span>
<span class="line"><span style="color:#85E89D;">+ }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">+ public function changeRoleActive(Request $request)</span></span>
<span class="line"><span style="color:#22863A;">+ {   </span></span>
<span class="line"><span style="color:#22863A;">+    auth(&#39;imissu-web&#39;)-&gt;user()-&gt;changeRoleActive($request-&gt;role_active);</span></span>
<span class="line"><span style="color:#22863A;">+    if (auth(&#39;imissu-web&#39;)-&gt;user()-&gt;role_active === $request-&gt;role_active) {</span></span>
<span class="line"><span style="color:#22863A;">+        return response()-&gt;json([</span></span>
<span class="line"><span style="color:#22863A;">+            &#39;message&#39; =&gt; &#39;Berhasil mengubah peran aktif&#39;,</span></span>
<span class="line"><span style="color:#22863A;">+            &#39;code&#39; =&gt; 200</span></span>
<span class="line"><span style="color:#22863A;">+        ], 200);</span></span>
<span class="line"><span style="color:#22863A;">+    } else {</span></span>
<span class="line"><span style="color:#22863A;">+        return response()-&gt;json([</span></span>
<span class="line"><span style="color:#22863A;">+            &#39;message&#39; =&gt; &#39;Gagal mengubah peran aktif&#39;,</span></span>
<span class="line"><span style="color:#22863A;">+            &#39;code&#39; =&gt; 403</span></span>
<span class="line"><span style="color:#22863A;">+        ], 403);</span></span>
<span class="line"><span style="color:#22863A;">+    }</span></span>
<span class="line"><span style="color:#22863A;">+ }</span></span></code></pre></div><ol start="6"><li>Daftarkan provider <code>WebSession</code> dan class <code>WebSession</code> di <code>config/app.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">&#39;providers&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// WebSession</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">App\\Providers\\WebSessionProvider</span><span style="color:#F97583;">::class</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">&#39;aliases&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// WebSession</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;WebSession&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">App\\Facades\\WebSession</span><span style="color:#F97583;">::class</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#032F62;">&#39;providers&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// WebSession</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#005CC5;">App\\Providers\\WebSessionProvider</span><span style="color:#D73A49;">::class</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">&#39;aliases&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// WebSession</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;WebSession&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">App\\Facades\\WebSession</span><span style="color:#D73A49;">::class</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">]</span></span></code></pre></div><ol start="7"><li>Refactor kode program di <code>app/Models/SSO/Web/User.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;?</span><span style="color:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">App\\Models\\SSO\\Web</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#F97583;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">App\\Facades\\WebSession</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">RistekUSDI\\SSO\\Laravel\\Models\\Web\\User</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Model</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Model</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> $appends </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;role_active_permissions&#39;</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setRoleActiveAttribute</span><span style="color:#E1E4E8;">($value)</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">attributes[</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">WebSession</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">setRoleActive</span><span style="color:#E1E4E8;">($value);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getRoleActiveAttribute</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">attributes[</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">WebSession</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">getRoleActive</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">getAttribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;client_roles&#39;</span><span style="color:#E1E4E8;">)[</span><span style="color:#9ECBFF;">&#39;0&#39;</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getRoleActivePermissionsAttribute</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">attributes[</span><span style="color:#9ECBFF;">&#39;role_active_permissions&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">WebSession</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">getRoleActivePermissions</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">getAttribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;client_roles&#39;</span><span style="color:#E1E4E8;">)[</span><span style="color:#9ECBFF;">&#39;0&#39;</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">changeRoleActive</span><span style="color:#E1E4E8;">($role_active)</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">WebSession</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">changeRoleActive</span><span style="color:#E1E4E8;">($role_active);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">forgetSession</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">WebSession</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">forgetSession</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;?</span><span style="color:#005CC5;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">namespace</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">App\\Models\\SSO\\Web</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#D73A49;">use</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">App\\Facades\\WebSession</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">use</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">RistekUSDI\\SSO\\Laravel\\Models\\Web\\User</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Model</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Model</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> $appends </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;role_active_permissions&#39;</span><span style="color:#24292E;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setRoleActiveAttribute</span><span style="color:#24292E;">($value)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line highlighted"><span style="color:#24292E;">        </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">attributes[</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">WebSession</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">setRoleActive</span><span style="color:#24292E;">($value);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getRoleActiveAttribute</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line highlighted"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">attributes[</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">WebSession</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">getRoleActive</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">getAttribute</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;client_roles&#39;</span><span style="color:#24292E;">)[</span><span style="color:#032F62;">&#39;0&#39;</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getRoleActivePermissionsAttribute</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line highlighted"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">attributes[</span><span style="color:#032F62;">&#39;role_active_permissions&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">WebSession</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">getRoleActivePermissions</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">getAttribute</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;client_roles&#39;</span><span style="color:#24292E;">)[</span><span style="color:#032F62;">&#39;0&#39;</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">changeRoleActive</span><span style="color:#24292E;">($role_active)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line highlighted"><span style="color:#24292E;">        </span><span style="color:#005CC5;">WebSession</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">changeRoleActive</span><span style="color:#24292E;">($role_active);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">forgetSession</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line highlighted"><span style="color:#24292E;">        </span><span style="color:#005CC5;">WebSession</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">forgetSession</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><ol start="8"><li>Tambahkan kode program berikut di <code>app/Services/WebSession.php</code>.</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;?</span><span style="color:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">App\\Services</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">WebSession</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setRoleActive</span><span style="color:#E1E4E8;">($value)</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">, $value);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> $value;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getRoleActive</span><span style="color:#E1E4E8;">($role)</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> $role;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getRoleActivePermissions</span><span style="color:#E1E4E8;">($role)</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        $role_active </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> $role;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            $role_active </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        $permissions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;Admin&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;disable-user&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;manage-roles&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;impersonate&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            ],</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;Developer&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;manage-settings&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;manage-users&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;manage-roles&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;impersonate&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            ],</span></span>
<span class="line"><span style="color:#E1E4E8;">        ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        $selected_permissions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">foreach</span><span style="color:#E1E4E8;"> ($permissions </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> $key </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> $value) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> ($key </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> $role_active) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                $selected_permissions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> $permissions[$key];</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> $selected_permissions;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">changeRoleActive</span><span style="color:#E1E4E8;">($role_active)</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">forget</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">, $role_active);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">forgetSession</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">forget</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;role_active&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;role_active_permissions&#39;</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">session</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;?</span><span style="color:#005CC5;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">namespace</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">App\\Services</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">WebSession</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setRoleActive</span><span style="color:#24292E;">($value)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">has</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">, $value);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> $value;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getRoleActive</span><span style="color:#24292E;">($role)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">has</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> $role;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getRoleActivePermissions</span><span style="color:#24292E;">($role)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        $role_active </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> $role;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">has</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">            $role_active </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        $permissions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;Admin&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;disable-user&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;manage-roles&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;impersonate&#39;</span></span>
<span class="line"><span style="color:#24292E;">            ],</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;Developer&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;manage-settings&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;manage-users&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;manage-roles&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;impersonate&#39;</span></span>
<span class="line"><span style="color:#24292E;">            ],</span></span>
<span class="line"><span style="color:#24292E;">        ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        $selected_permissions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">foreach</span><span style="color:#24292E;"> ($permissions </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> $key </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> $value) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> ($key </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> $role_active) {</span></span>
<span class="line"><span style="color:#24292E;">                $selected_permissions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> $permissions[$key];</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> $selected_permissions;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">changeRoleActive</span><span style="color:#24292E;">($role_active)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">forget</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">, $role_active);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">forgetSession</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">forget</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;role_active&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;role_active_permissions&#39;</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">session</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><ol start="7"><li>Ganti baris kode di <code>resources/views/sso-web/advance.blade.php</code>.</li></ol><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#FDAEB7;">- &lt;input type=&quot;hidden&quot; name=&quot;url_change_role_active&quot; value=&quot;{{ url(&#39;/sso-web-demo/change-role-active&#39;) }}&quot;&gt;</span></span>
<span class="line"><span style="color:#85E89D;">+ &lt;input type=&quot;hidden&quot; name=&quot;url_change_role_active&quot; value=&quot;{{ url(&#39;/web-session/change-role-active&#39;) }}&quot;&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#B31D28;">- &lt;input type=&quot;hidden&quot; name=&quot;url_change_role_active&quot; value=&quot;{{ url(&#39;/sso-web-demo/change-role-active&#39;) }}&quot;&gt;</span></span>
<span class="line"><span style="color:#22863A;">+ &lt;input type=&quot;hidden&quot; name=&quot;url_change_role_active&quot; value=&quot;{{ url(&#39;/web-session/change-role-active&#39;) }}&quot;&gt;</span></span></code></pre></div><ol start="8"><li>Cek ulang apakah halaman &quot;Advance&quot; masih tetap berjalan sebelum direfactoring. Jika berhasil maka proses refactoring sudah berhasil. Jika gagal silakan cek kembali langkah-langkah di atas.</li></ol><h2 id="web-guard-auth" tabindex="-1">Web Guard - Auth <a class="header-anchor" href="#web-guard-auth" aria-label="Permalink to &quot;Web Guard - Auth&quot;">​</a></h2><p>Berikut perintah-perintah yang digunakan untuk mengakses data pengguna SSO.</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Attributes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// sub adalah id user di Keycloak.</span></span>
<span class="line"><span style="color:#6A737D;">// TIDAK DIREKOMENDASIKAN menggunakan atribut ini utk menyimpan nilai.</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">sub;</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">preferred_username;</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">name;</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">email;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Daftar peran pengguna dalam suatu aplikasi.</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">client_roles;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// id user di Unud.</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">unud_identifier_id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// id sso Unud.</span></span>
<span class="line"><span style="color:#6A737D;">// DIREKOMENDASIKAN untuk menggunakan atribut ini untuk menyimpan nilai.</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">unud_sso_id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// id tipe pengguna di Unud.</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">unud_user_type_id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Virtual attributes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">username;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Identifier = NIP/NIM</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">identifier;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Identitas lengkap dalam bentuk NIP/NIM Nama pengguna</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">full_identity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Methods</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna memiliki peran tertentu dalam daftar peran aplikasi. </span></span>
<span class="line"><span style="color:#6A737D;">// Nilai \`$roles\` bertipe string atau array.</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">hasRole</span><span style="color:#E1E4E8;">($roles);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna sedang dalam peran aktif tertentu.</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">hasRoleActive</span><span style="color:#E1E4E8;">($roles);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna memiliki permissions yang melekat pada peran aktif pengguna.</span></span>
<span class="line"><span style="color:#6A737D;">// Nilai \`$permissions\` bertipe string atau array.</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">hasPermission</span><span style="color:#E1E4E8;">($permissions);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Utility</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna sudah login?</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">check</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna belum login?</span></span>
<span class="line"><span style="color:#B392F0;">auth</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">guest</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Attributes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// sub adalah id user di Keycloak.</span></span>
<span class="line"><span style="color:#6A737D;">// TIDAK DIREKOMENDASIKAN menggunakan atribut ini utk menyimpan nilai.</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">sub;</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">preferred_username;</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">name;</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">email;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Daftar peran pengguna dalam suatu aplikasi.</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">client_roles;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// id user di Unud.</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">unud_identifier_id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// id sso Unud.</span></span>
<span class="line"><span style="color:#6A737D;">// DIREKOMENDASIKAN untuk menggunakan atribut ini untuk menyimpan nilai.</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">unud_sso_id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// id tipe pengguna di Unud.</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">unud_user_type_id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Virtual attributes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">username;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Identifier = NIP/NIM</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">identifier;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Identitas lengkap dalam bentuk NIP/NIM Nama pengguna</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">full_identity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Methods</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna memiliki peran tertentu dalam daftar peran aplikasi. </span></span>
<span class="line"><span style="color:#6A737D;">// Nilai \`$roles\` bertipe string atau array.</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">hasRole</span><span style="color:#24292E;">($roles);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna sedang dalam peran aktif tertentu.</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">hasRoleActive</span><span style="color:#24292E;">($roles);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna memiliki permissions yang melekat pada peran aktif pengguna.</span></span>
<span class="line"><span style="color:#6A737D;">// Nilai \`$permissions\` bertipe string atau array.</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">hasPermission</span><span style="color:#24292E;">($permissions);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Utility</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna sudah login?</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">check</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mengecek apakah pengguna belum login?</span></span>
<span class="line"><span style="color:#6F42C1;">auth</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">guest</span><span style="color:#24292E;">();</span></span></code></pre></div><h2 id="web-guard-middleware" tabindex="-1">Web Guard Middleware <a class="header-anchor" href="#web-guard-middleware" aria-label="Permalink to &quot;Web Guard Middleware&quot;">​</a></h2><p>Berikut daftar web middleware yang disediakan oleh SSO Laravel.</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// Middleware untuk mengecek apakah pengguna sudah terotentikasi.</span></span>
<span class="line"><span style="color:#6A737D;">// Jika belum terotentikasi maka diarahkan ke halaman login.</span></span>
<span class="line"><span style="color:#B392F0;">middleware</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Middleware untuk mengecek apakah pengguna memiliki peran Admin dan atau Developer</span></span>
<span class="line"><span style="color:#6A737D;">// Jika peran yang ingin dicek lebih dari satu maka gunakan tanda &quot;|&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">Route</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">middleware</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web.role:Admin|Developer&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Middleware untuk mengecek apakah pengguna memiliki peran aktif sebagai Admin atau Developer</span></span>
<span class="line"><span style="color:#6A737D;">// Jika peran aktif yang ingin dicek lebih dari satu maka gunakan tanda &quot;|&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">Route</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">middleware</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web.role_active:Admin|Developer&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Middleware untuk mengecek apakah pengguna memiliki permission user.create dan atau user.view</span></span>
<span class="line"><span style="color:#6A737D;">// Jika permission yang ingin dicek lebih dari satu maka gunakan tanda &quot;|&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">Route</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">middleware</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;imissu-web.permission:user.create|user.view&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// Middleware untuk mengecek apakah pengguna sudah terotentikasi.</span></span>
<span class="line"><span style="color:#6A737D;">// Jika belum terotentikasi maka diarahkan ke halaman login.</span></span>
<span class="line"><span style="color:#6F42C1;">middleware</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Middleware untuk mengecek apakah pengguna memiliki peran Admin dan atau Developer</span></span>
<span class="line"><span style="color:#6A737D;">// Jika peran yang ingin dicek lebih dari satu maka gunakan tanda &quot;|&quot;</span></span>
<span class="line"><span style="color:#005CC5;">Route</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">middleware</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web.role:Admin|Developer&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Middleware untuk mengecek apakah pengguna memiliki peran aktif sebagai Admin atau Developer</span></span>
<span class="line"><span style="color:#6A737D;">// Jika peran aktif yang ingin dicek lebih dari satu maka gunakan tanda &quot;|&quot;</span></span>
<span class="line"><span style="color:#005CC5;">Route</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">middleware</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web.role_active:Admin|Developer&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Middleware untuk mengecek apakah pengguna memiliki permission user.create dan atau user.view</span></span>
<span class="line"><span style="color:#6A737D;">// Jika permission yang ingin dicek lebih dari satu maka gunakan tanda &quot;|&quot;</span></span>
<span class="line"><span style="color:#005CC5;">Route</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">middleware</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;imissu-web.permission:user.create|user.view&#39;</span><span style="color:#24292E;">);</span></span></code></pre></div><h2 id="soal-sering-ditanya" tabindex="-1">Soal Sering Ditanya <a class="header-anchor" href="#soal-sering-ditanya" aria-label="Permalink to &quot;Soal Sering Ditanya&quot;">​</a></h2><h3 id="bagaimana-cara-mendapatkan-access-token-dan-refresh-token" tabindex="-1">Bagaimana cara mendapatkan access token dan refresh token? <a class="header-anchor" href="#bagaimana-cara-mendapatkan-access-token-dan-refresh-token" aria-label="Permalink to &quot;Bagaimana cara mendapatkan access token dan refresh token?&quot;">​</a></h3><p>Ada dua cara untuk mendapatkan access token dan refresh token:</p><ol><li><p>Mengimpor facade <code>IMISSUWeb</code> dengan perintah <code>use RistekUSDI\\SSO\\Laravel\\Facades\\IMISSUWeb;</code>, kemudian jalankan perintah <code>IMISSUWeb::retrieveToken()</code>.</p></li><li><p>Menggunakan session. Gunakan perintah <code>session()-&gt;get(&#39;_sso_token.access_token&#39;)</code> untuk mendapatkan access token dan <code>session()-&gt;get(&#39;_sso_token.refresh_token&#39;)</code>.</p></li></ol>`,97),E=[r];function y(i,F,u,d,g,h){return a(),n("div",null,E)}const v=s(c,[["render",y]]);export{m as __pageData,v as default};
